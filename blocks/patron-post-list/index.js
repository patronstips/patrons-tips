(()=>{"use strict";var t,e={335:()=>{const t=window.wp.blocks,e=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"patrons-tips/patron-post-list","version":"1.0.4","category":"patrons-tips","icon":"excerpt-view","title":"Patron post list","description":"Display a list of posts, images or products with patronage restrictions.","keywords":["patronage","patron","list","posts","images","media","products","restricted","tier","locked","unlocked","gray out","filtered"],"example":{},"supports":{"html":false},"attributes":{"userID":{"type":"integer","default":0},"userEmail":{"type":"string","default":""},"patronID":{"type":"integer","default":0},"types":{"type":"array","default":["post"]},"categories":{"type":"array","default":[]},"tags":{"type":"array","default":[]},"catAndTag":{"type":"boolean","default":true},"restricted":{"type":"integer","default":-1},"unlocked":{"type":"integer","default":-1},"perPage":{"type":"integer","default":12},"grayOut":{"type":"boolean","default":true},"imageOnly":{"type":"boolean","default":false},"imageSize":{"type":"string","default":""},"noLink":{"type":"boolean","default":false}},"textdomain":"patrons-tips","editorScript":"file:index.js","editorStyle":"file:index.css","style":"file:style-index.css","script":["patips-js-global-variables","patips-js-global-functions"]}'),a=window.wp.i18n,s=window.wp.blockEditor,r=window.wp.element,o=window.wp.components;const i=window.wp.data,n=window.ReactJSXRuntime;function l(t){const{postCategories:e,postTags:l,productCategories:p,productTags:u,attachmentCategories:c}=(0,i.useSelect)((t=>{const{getEntityRecords:e}=t("core");return{postCategories:e("taxonomy","category"),postTags:e("taxonomy","post_tag"),productCategories:e("taxonomy","product_cat"),productTags:e("taxonomy","product_tag"),attachmentCategories:e("taxonomy","patips_attachment_cat")}})),d=t=>{var a;t=null!==(a=t)&&void 0!==a?a:"";let s=[];return("tag"===t?[l,u]:[e,p,c]).forEach((t=>{var e;(t=null!==(e=t)&&void 0!==e?e:[]).length&&(s=s.concat(t))})),s},g=t=>{var e;t=null!==(e=t)&&void 0!==e?e:"";let a=d("tag"===t?"tag":"category");return a.length?a.map((t=>t.name+" (#"+t.id+")")):[]},b=e=>{var a;e=null!==(a=e)&&void 0!==a?a:"";let s=d("tag"===e?"tag":"category"),r="tag"===e?t.attributes.tags:t.attributes.categories,o=[];return r.forEach((t=>{let e="(#"+t+")",a=s.find((e=>t===parseInt(e.id)));void 0!==a&&(e=a.name+" "+e),o.push(e)})),o},[m,_]=(0,r.useState)((()=>b("category"))),[y,v]=(0,r.useState)((()=>b("tag")));return(0,r.useEffect)((()=>{t.setAttributes({categories:m.map((t=>parseInt(t.substring(t.lastIndexOf("#")+1,t.lastIndexOf(")")))))})}),[m]),(0,r.useEffect)((()=>{t.setAttributes({tags:y.map((t=>parseInt(t.substring(t.lastIndexOf("#")+1,t.lastIndexOf(")")))))})}),[y]),(0,r.useEffect)((()=>{let t=b("category");_(t)}),[e,p,c]),(0,r.useEffect)((()=>{let t=b("tag");v(t)}),[l,u]),(0,n.jsxs)(s.InspectorControls,{children:[(0,n.jsxs)(o.PanelBody,{title:(0,a.__)("Filters","patrons-tips"),children:[(0,n.jsx)(o.SelectControl,{multiple:!0,label:(0,a.__)("Types","patrons-tips"),value:t.attributes.types,options:[{label:(0,a.__)("Posts","patrons-tips"),value:"post"},{label:(0,a.__)("Pages","patrons-tips"),value:"page"},{label:(0,a.__)("Media","patrons-tips"),value:"attachment"},{label:(0,a.__)("Products","patrons-tips"),value:"product"}],onChange:e=>t.setAttributes({types:e})}),(0,n.jsx)(o.FormTokenField,{label:(0,a.__)("Categories","patrons-tips"),value:m,suggestions:g("category"),onChange:t=>{_(t)},__experimentalShowHowTo:!0,__experimentalExpandOnFocus:!0}),(0,n.jsx)(o.FormTokenField,{label:(0,a.__)("Tags","patrons-tips"),value:y,suggestions:g("tag"),onChange:t=>{v(t)},__experimentalShowHowTo:!0,__experimentalExpandOnFocus:!0}),(0,n.jsx)(o.ToggleControl,{label:(0,a.__)("Cumulate categories and tags","patrons-tips"),checked:t.attributes.catAndTag,onChange:()=>t.setAttributes({catAndTag:!t.attributes.catAndTag})}),(0,n.jsx)(o.SelectControl,{label:(0,a.__)("Restricted","patrons-tips"),value:t.attributes.restricted,options:[{label:(0,a.__)("Show both restricted and not restricted posts","patrons-tips"),value:-1},{label:(0,a.__)("Show only not restricted posts","patrons-tips"),value:0},{label:(0,a.__)("Show only restricted posts","patrons-tips"),value:1}],onChange:e=>t.setAttributes({restricted:parseInt(e),unlocked:1!==parseInt(e)?-1:t.attributes.unlocked})}),1===parseInt(t.attributes.restricted)&&(0,n.jsx)(o.SelectControl,{label:(0,a.__)("Unlocked","patrons-tips"),value:t.attributes.unlocked,options:[{label:(0,a.__)("Show both locked and unlocked posts","patrons-tips"),value:-1},{label:(0,a.__)("Show only locked posts","patrons-tips"),value:0},{label:(0,a.__)("Show only unlocked posts","patrons-tips"),value:1}],onChange:e=>t.setAttributes({unlocked:parseInt(e),restricted:parseInt(e)>=0?1:t.attributes.restricted})}),(0,n.jsx)(o.TextControl,{type:"number",label:(0,a.__)("Per page","patrons-tips"),value:t.attributes.perPage,onChange:e=>t.setAttributes({perPage:parseInt(e)})})]}),(0,n.jsxs)(o.PanelBody,{title:(0,a.__)("Display","patrons-tips"),children:[(0,n.jsx)(o.ToggleControl,{label:(0,a.__)("Gray Out locked posts","patrons-tips"),checked:t.attributes.grayOut,onChange:()=>t.setAttributes({grayOut:!t.attributes.grayOut})}),(0,n.jsx)(o.ToggleControl,{label:(0,a.__)("Show image only","patrons-tips"),checked:t.attributes.imageOnly,onChange:()=>t.setAttributes({imageOnly:!t.attributes.imageOnly})}),(0,n.jsx)(o.SelectControl,{label:(0,a.__)("Image size","patrons-tips"),value:t.attributes.imageSize,options:[{label:(0,a.__)("Auto","patrons-tips"),value:""},{label:(0,a.__)("Full Size","patrons-tips"),value:"full"},{label:(0,a.__)("Large","patrons-tips"),value:"large"},{label:(0,a.__)("Medium","patrons-tips"),value:"medium"},{label:(0,a.__)("Thumbnail","patrons-tips"),value:"thumbnail"}],onChange:e=>t.setAttributes({imageSize:e})}),(0,n.jsx)(o.ToggleControl,{label:(0,a.__)("Remove links","patrons-tips"),checked:t.attributes.noLink,onChange:()=>t.setAttributes({noLink:!t.attributes.noLink})})]})]})}const p={from:[{type:"shortcode",tag:["patronstips_patron_posts"],isMatch:t=>!0,transform(e,a){var s;return(0,t.createBlock)("patrons-tips/patron-post-list",{types:void 0!==e?.named?.types?e.named.types.split(",").map((t=>t.trim())):[],categories:void 0!==e?.named?.categories?e.named.categories.split(",").map((t=>parseInt(t))):[],tags:void 0!==e?.named?.tags?e.named.tags.split(",").map((t=>parseInt(t))):[],restricted:void 0!==e?.named?.restricted&&parseInt(e.named.restricted),unlocked:void 0!==e?.named?.unlocked&&parseInt(e.named.unlocked),perPage:void 0!==e?.named?.per_page?parseInt(e.named.per_page):12,grayOut:void 0===e?.named?.gray_out||parseInt(e.named.gray_out),imageOnly:void 0!==e?.named?.image_only&&parseInt(e.named.image_only),imageSize:null!==(s=instance?.raw?.image_size)&&void 0!==s?s:"",noLink:void 0!==e?.named?.no_link&&parseInt(e.named.no_link)})}}]};(0,t.registerBlockType)(e,{edit:function(t){const e=(0,s.useBlockProps)(),[i,p]=(0,r.useState)(!1),[u,c]=(0,r.useState)(""),d=(g=300,b=()=>{p(!0),fetch(patips_var.ajaxurl,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams({action:"patipsGetPatronPostList",user_id:t.attributes.userID,user_email:t.attributes.userEmail,patron_id:t.attributes.patronID,types:JSON.stringify(t.attributes.types),categories:JSON.stringify(t.attributes.categories),tags:JSON.stringify(t.attributes.tags),cat_and_tag:t.attributes.catAndTag?1:0,restricted:parseInt(t.attributes.restricted),unlocked:parseInt(t.attributes.unlocked),per_page:t.attributes.perPage,gray_out:t.attributes.grayOut?1:0,image_only:t.attributes.imageOnly?1:0,image_size:t.attributes.imageSize,nonce:patips_var.nonce_get_patron_post_list})}).then((t=>t.json())).then((t=>{"success"===t?.status&&void 0!==t.html&&c(t.html?t.html:(0,a.__)("No results.","patrons-tips")),p(!1)})).catch((t=>{console.log("AJAX error",t),p(!1)}))},_=(m||{}).atBegin,function(t,e,a){var s,r=a||{},o=r.noTrailing,i=void 0!==o&&o,n=r.noLeading,l=void 0!==n&&n,p=r.debounceMode,u=void 0===p?void 0:p,c=!1,d=0;function g(){s&&clearTimeout(s)}function b(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];var n=this,p=Date.now()-d;function b(){d=Date.now(),e.apply(n,r)}function m(){s=void 0}c||(l||!u||s||b(),g(),void 0===u&&p>t?l?(d=Date.now(),i||(s=setTimeout(u?m:b,t))):b():!0!==i&&(s=setTimeout(u?m:b,void 0===u?t-p:t)))}return b.cancel=function(t){var e=(t||{}).upcomingOnly,a=void 0!==e&&e;g(),c=!a},b}(g,b,{debounceMode:!1!==(void 0!==_&&_)}));var g,b,m,_;return(0,r.useEffect)((()=>{d()}),[t.attributes.types,t.attributes.categories,t.attributes.tags,t.attributes.catAndTag,t.attributes.restricted,t.attributes.unlocked,t.attributes.perPage,t.attributes.grayOut,t.attributes.imageOnly,t.attributes.imageSize]),(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(l,{attributes:{types:t.attributes.types,categories:t.attributes.categories,tags:t.attributes.tags,catAndTag:t.attributes.catAndTag,restricted:t.attributes.restricted,unlocked:t.attributes.unlocked,perPage:t.attributes.perPage,grayOut:t.attributes.grayOut,imageOnly:t.attributes.imageOnly,imageSize:t.attributes.imageSize,noLink:t.attributes.noLink},setAttributes:t.setAttributes}),(0,n.jsx)("div",{...e,children:(0,n.jsx)("div",{className:"patips-patron-post-list-block"+(t.isSelected?" patips-selected-block":""),children:i?(0,n.jsx)(o.Spinner,{}):(0,n.jsx)(r.RawHTML,{children:u})})})]})},save:function(t){return null},transforms:p})}},a={};function s(t){var r=a[t];if(void 0!==r)return r.exports;var o=a[t]={exports:{}};return e[t](o,o.exports,s),o.exports}s.m=e,t=[],s.O=(e,a,r,o)=>{if(!a){var i=1/0;for(u=0;u<t.length;u++){for(var[a,r,o]=t[u],n=!0,l=0;l<a.length;l++)(!1&o||i>=o)&&Object.keys(s.O).every((t=>s.O[t](a[l])))?a.splice(l--,1):(n=!1,o<i&&(i=o));if(n){t.splice(u--,1);var p=r();void 0!==p&&(e=p)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[a,r,o]},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={320:0,432:0};s.O.j=e=>0===t[e];var e=(e,a)=>{var r,o,[i,n,l]=a,p=0;if(i.some((e=>0!==t[e]))){for(r in n)s.o(n,r)&&(s.m[r]=n[r]);if(l)var u=l(s)}for(e&&e(a);p<i.length;p++)o=i[p],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(u)},a=globalThis.webpackChunkpatips_blocks=globalThis.webpackChunkpatips_blocks||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))})();var r=s.O(void 0,[432],(()=>s(335)));r=s.O(r)})();