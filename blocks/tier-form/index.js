(()=>{"use strict";var t,e={703:()=>{const t=window.wp.blocks,e=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"patrons-tips/tier-form","version":"1.0.4","category":"patrons-tips","icon":"cart","title":"Patronage form","description":"Display a form to add tier products to cart.","keywords":["patronage","form","tier","product","cart","subscribe","pledge","purchase","buy","support","sign up"],"example":{},"supports":{"html":false},"attributes":{"tiers":{"type":"array","default":[]},"defaultTier":{"type":"integer","default":0},"frequencies":{"type":"array","default":[]},"defaultFrequency":{"type":"string","default":""},"decimals":{"type":"integer","default":0},"submitLabel":{"type":"string","default":""}},"textdomain":"patrons-tips","editorScript":"file:index.js","editorStyle":"file:index.css","style":"file:style-index.css","script":["patips-js-global-variables","patips-js-global-functions"]}'),i=window.wp.i18n,s=window.wp.blockEditor,r=window.wp.element,a=window.wp.components,n=window.ReactJSXRuntime;function l(t){var e,r,l;const o=null!==(e=patips_var?.tiers)&&void 0!==e?e:{},u=t.getFrequencyName,p=t=>{var e;t=null!==(e=t)&&void 0!==e?e:"";let s=[];return"auto"===t&&s.push({value:0,label:(0,i.__)("Auto","patrons-tips")}),o&&Object.keys(o).map((t=>{var e;let r=o[t];s.push({value:r.id,
/* translators: %s is the tier ID */
label:null!==(e=r?.title)&&void 0!==e?e:(0,i.sprintf)((0,i.__)("Tier #%s","patrons-tips"),r.id)})})),s},d=t=>{var e;t=null!==(e=t)&&void 0!==e?e:"";let s=[],r=[];return"auto"===t&&s.push({value:"",label:(0,i.__)("Auto","patrons-tips")}),o&&Object.keys(o).map((t=>{let e=o[t];e?.product_ids&&Object.keys(e.product_ids).map((t=>{r.includes(t)||(r.push(t),s.push({value:t,label:u(t)}))}))})),s};return(0,n.jsx)(s.InspectorControls,{children:(0,n.jsxs)(a.PanelBody,{title:(0,i.__)("Patronage form options","patrons-tips"),children:[(0,n.jsx)(a.SelectControl,{multiple:!0,label:(0,i.__)("Tiers","patrons-tips"),value:t.attributes.tiers,options:p(),onChange:e=>t.setAttributes({tiers:e.map((t=>parseInt(t)))})}),(0,n.jsx)(a.SelectControl,{label:(0,i.__)("Default tier","patrons-tips"),value:t.attributes.defaultTier,options:p("auto"),onChange:e=>{return t.setAttributes({defaultTier:(i=e,!isNaN(parseFloat(i))&&isFinite(i)?parseInt(e):0)});var i}}),""!==(null!==(r=patips_var?.subscription_plugin)&&void 0!==r?r:"")&&(0,n.jsx)(a.SelectControl,{multiple:!0,label:(0,i.__)("Frequencies","patrons-tips"),value:t.attributes.frequencies,options:d(),onChange:e=>t.setAttributes({frequencies:e})}),""!==(null!==(l=patips_var?.subscription_plugin)&&void 0!==l?l:"")&&(0,n.jsx)(a.SelectControl,{label:(0,i.__)("Default Frequency","patrons-tips"),value:t.attributes.defaultFrequency,options:d("auto"),onChange:e=>t.setAttributes({defaultFrequency:e})}),(0,n.jsx)(a.RangeControl,{label:(0,i.__)("Number of decimals","patrons-tips"),value:t.attributes.decimals,onChange:e=>t.setAttributes({decimals:parseInt(e)}),min:0,max:3,step:1,withInputField:!0,isShiftStepEnabled:!0})]})})}function o(t){var e,s,a,l,o,u,p;const d=null!==(e=t?.tier?.id)&&void 0!==e?e:0,c=null!==(s=t?.productsPrice)&&void 0!==s?s:{},f=null!==(a=t?.attributes?.defaultFrequency)&&void 0!==a?a:"",b=!!t?.isDefault,m=(()=>{var e;let i=!1;return t?.tier?.product_ids&&Object.keys(t?.tier?.product_ids).map((e=>{let s=t.tier.product_ids[e],r=parseInt(s[0]);(!1===i||r&&e===f)&&void 0!==c?.[e]?.[r]&&(i=c?.[e]?.[r])})),!1!==i?i:null!==(e=t?.tier?.price)&&void 0!==e?e:0})();return(0,n.jsx)("div",{className:"patips-tier-option-container"+(b?" patips-selected":""),id:"patips-tier-option-container-"+d,"data-tier_id":d,children:(0,n.jsx)("label",{htmlFor:"patips-tier-option-input-"+d,children:(0,n.jsxs)("div",{className:"patips-tier-option",children:[(0,n.jsx)(r.RawHTML,{className:"patips-tier-option-icon",children:null!==(l=t?.tier?.icon)&&void 0!==l?l:""}),(0,n.jsxs)("div",{className:"patips-tier-option-text",children:[(0,n.jsx)("div",{className:"patips-tier-option-title",children:/* translators: %s is the tier ID */null!==(o=t?.tier?.title)&&void 0!==o?o:(0,i.sprintf)((0,i.__)("Tier #%s","patrons-tips"),d)}),(0,n.jsx)("div",{className:"patips-tier-option-price",children:patips_format_price(m,{plain_text:!0,decimals:null!==(u=t?.attributes?.decimals)&&void 0!==u?u:0})}),(0,n.jsx)("div",{className:"patips-tier-option-description",children:null!==(p=t?.tier?.description)&&void 0!==p?p:""})]})]})})})}const u={from:[{type:"block",blocks:["core/legacy-widget"],isMatch:({idBase:t,instance:e})=>e?.raw&&"patips_widget_tier_form"===t,transform({instance:e}){var s,r,a,n,l;return(0,t.createBlock)("patrons-tips/tier-form",{tiers:null!==(s=e?.raw?.tiers)&&void 0!==s?s:[],defaultTier:null!==(r=e?.raw?.default_tier)&&void 0!==r?r:0,frequencies:null!==(a=e?.raw?.frequencies)&&void 0!==a?a:[],defaultFrequency:null!==(n=e?.raw?.default_frequency)&&void 0!==n?n:"",decimals:void 0!==e?.raw?.decimals?parseInt(e?.raw?.decimals):0,submitLabel:null!==(l=e?.raw?.submit_label)&&void 0!==l?l:(0,i.__)("Add to cart","patrons-tips")})}},{type:"shortcode",tag:["patronstips_tier_form"],isMatch:t=>!0,transform(e,s){var r,a;return(0,t.createBlock)("patrons-tips/tier-form",{tiers:void 0!==e?.named?.tiers?e.named.tiers.split(",").map((t=>parseInt(t))):[],defaultTier:void 0===e?.named?.default_tier||isNaN(parseInt(e?.named?.default_tier))?0:parseInt(e.named.default_tier),frequencies:void 0!==e?.named?.frequencies?e.named.frequencies.split(",").map((t=>t.trim())):[],defaultFrequency:null!==(r=e?.named?.default_frequency)&&void 0!==r?r:"",decimals:void 0===e?.named?.decimals||isNaN(parseInt(e?.named?.decimals))?0:parseInt(e.named.decimals),submitLabel:null!==(a=e?.named?.submit_label)&&void 0!==a?a:(0,i.__)("Add to cart","patrons-tips")})}}]};(0,t.registerBlockType)(e,{edit:function(t){var e,u;const p=(0,s.useBlockProps)(),d=null!==(e=patips_var?.tiers)&&void 0!==e?e:{},c=(t,e)=>{var s;e=void 0===e||e;let r=t.indexOf("_"),a=!1!==r?parseInt(t.substr(0,r)):1,n=!1!==r?t.substr(r+1):t;"one_off"===t&&(a=0,n="one_off");let l={one_off:(0,i.__)("one-off","patrons-tips"),day:1===a&&e?(0,i.__)("daily","patrons-tips"):(0,i.sprintf)((0,i._n)("%s day","%s days",a,"patrons-tips"),a),week:1===a&&e?(0,i.__)("weekly","patrons-tips"):(0,i.sprintf)((0,i._n)("%s week","%s weeks",a,"patrons-tips"),a),month:1===a&&e?(0,i.__)("monthly","patrons-tips"):(0,i.sprintf)((0,i._n)("%s month","%s months",a,"patrons-tips"),a),year:1===a&&e?(0,i.__)("yearly","patrons-tips"):(0,i.sprintf)((0,i._n)("%s year","%s years",a,"patrons-tips"),a)},o=null!==(s=l?.[n])&&void 0!==s?s:t;return e&&1!==a&&"one_off"!==t&&void 0!==l?.[n]&&(
/* translators: %s = number + period (e.g. "2 months", "4 weeks", "3 years", etc.) */
o=(0,i.sprintf)((0,i.__)("every %s","patrons-tips"),o)),o},f=()=>{let e=[];return d&&Object.keys(d).map((i=>{let s=d[i];t.attributes.tiers.length&&!t.attributes.tiers.includes(s.id)||e.push(s)})),e},b=()=>{let e=[];return d&&Object.keys(d).map((i=>{let s=d[i];s?.product_ids&&Object.keys(s.product_ids).map((i=>{t.attributes.frequencies.length&&!t.attributes.frequencies.includes(i)||e.includes(i)||e.push(i)}))})),e},[m,v]=(0,r.useState)((()=>f())),[_,y]=(0,r.useState)((()=>b())),h=()=>{let e=t.attributes.defaultTier;if(0===e&&m.length){let t=m[Math.max(0,Math.ceil(m.length/2)-1)];e=void 0!==t?parseInt(t?.id):0}return e},j=()=>{let e=t.attributes.defaultFrequency;return""===e&&_.length&&(e=_[_.length-1]),e},[x,g]=(0,r.useState)((()=>h())),[w,q]=(0,r.useState)((()=>j())),[k,N]=(0,r.useState)(null!==(u=t.attributes.submitLabel)&&void 0!==u?u:"");return(0,r.useEffect)((()=>{const t=f();v(t)}),[t.attributes.tiers]),(0,r.useEffect)((()=>{const t=h();g(t)}),[t.attributes.defaultTier,m]),(0,r.useEffect)((()=>{const t=b();y(t)}),[t.attributes.frequencies]),(0,r.useEffect)((()=>{const t=j();q(t)}),[t.attributes.defaultFrequency,_]),(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(l,{getFrequencyName:c,attributes:{tiers:t.attributes.tiers,defaultTier:t.attributes.defaultTier,frequencies:t.attributes.frequencies,defaultFrequency:t.attributes.defaultFrequency,decimals:t.attributes.decimals,submitLabel:t.attributes.submitLabel},setAttributes:t.setAttributes}),(0,n.jsx)("div",{...p,children:(0,n.jsxs)("div",{className:"patips-add-to-cart-tier-form"+(t.isSelected?" patips-selected-block":""),children:[(0,n.jsx)("div",{className:"patips-tier-options-container",children:m&&Object.keys(m).map((e=>{var i;let s=m[e];return(0,n.jsx)(o,{tier:s,productsPrice:null!==(i=patips_var?.tiers_products_price?.[s.id])&&void 0!==i?i:{},attributes:{defaultFrequency:t.attributes.defaultFrequency,decimals:t.attributes.decimals},isDefault:x&&x===s.id||!x&&0===e,isSelected:t.isSelected},s.id)}))}),(0,n.jsx)("div",{className:"patips-tier-frequency-container",children:_&&Object.keys(_).map((t=>{let e=_[t],i=c(e);return(0,n.jsx)("div",{id:"patips-tier-frequency-"+e,className:"patips-tier-frequency"+(w&&w===e?" patips-selected":""),children:(0,n.jsx)("label",{htmlFor:"patips-tier-frequency-input-"+e,children:i})},e)}))}),(0,n.jsx)("div",{className:"patips-tier-form-submit-container",children:t.isSelected?(0,n.jsx)(a.TextControl,{type:"text",label:(0,i.__)("Submit button label","patrons-tips"),value:t.attributes.submitLabel,onChange:e=>t.setAttributes({submitLabel:e})}):(0,n.jsx)("input",{type:"button",value:""!==t.attributes.submitLabel?t.attributes.submitLabel:(0,i.__)("Become patron","patrons-tips"),className:"patips-tier-form-submit"})})]})})]})},save:function(t){return null},transforms:u})}},i={};function s(t){var r=i[t];if(void 0!==r)return r.exports;var a=i[t]={exports:{}};return e[t](a,a.exports,s),a.exports}s.m=e,t=[],s.O=(e,i,r,a)=>{if(!i){var n=1/0;for(p=0;p<t.length;p++){for(var[i,r,a]=t[p],l=!0,o=0;o<i.length;o++)(!1&a||n>=a)&&Object.keys(s.O).every((t=>s.O[t](i[o])))?i.splice(o--,1):(l=!1,a<n&&(n=a));if(l){t.splice(p--,1);var u=r();void 0!==u&&(e=u)}}return e}a=a||0;for(var p=t.length;p>0&&t[p-1][2]>a;p--)t[p]=t[p-1];t[p]=[i,r,a]},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={109:0,777:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var r,a,[n,l,o]=i,u=0;if(n.some((e=>0!==t[e]))){for(r in l)s.o(l,r)&&(s.m[r]=l[r]);if(o)var p=o(s)}for(e&&e(i);u<n.length;u++)a=n[u],s.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return s.O(p)},i=globalThis.webpackChunkpatips_blocks=globalThis.webpackChunkpatips_blocks||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var r=s.O(void 0,[777],(()=>s(703)));r=s.O(r)})();