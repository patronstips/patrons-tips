(()=>{"use strict";var e,t={886:()=>{const e=window.wp.blocks,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"patrons-tips/period-media","version":"1.0.4","category":"patrons-tips","icon":"format-image","title":"Patronage image of the month","description":"Display the highlighted media preview for the current period.","keywords":["patronage","attachment","image","media","period","month","feature","reward","preview","current"],"example":{},"supports":{"html":false},"attributes":{"period":{"type":"string","default":"current"},"categories":{"type":"array","default":[]},"imageSize":{"type":"string","default":"large"},"perPage":{"type":"integer","default":1}},"textdomain":"patrons-tips","editorScript":"file:index.js","editorStyle":"file:index.css","style":"file:style-index.css","script":["patips-js-global-variables","patips-js-global-functions"]}'),a=window.wp.i18n,i=window.wp.blockEditor,r=window.wp.element,o=window.wp.components;const n=window.wp.data,s=window.ReactJSXRuntime;function l(e){var t,i,r,n,l;const p=null!==(t=e?.periodDuration)&&void 0!==t?t:void 0!==patips_var?.period_duration?parseInt(patips_var.period_duration):1,d=null!==(i=e?.periodNb)&&void 0!==i?i:12,c=null!==(r=e?.options)&&void 0!==r?r:[],u=(e,t,a)=>{let i=new Date(e,t,a||1),r=void 0!==patips_var?.locale?patips_var.locale.replace("_","-"):"en-US";return i.toLocaleString(r,a?{day:"numeric",month:"long",year:"numeric"}:{month:"long",year:"numeric"})};return(0,s.jsx)(o.SelectControl,{label:null!==(n=e?.label)&&void 0!==n?n:"",value:null!==(l=e?.value)&&void 0!==l?l:"",options:(()=>{let e=c.concat([{label:(0,a.__)("Current period","patrons-tips"),value:"current"}]),t=new Date;t.setDate(1);for(let i=1;i<=d;i++)t.setMonth(t.getMonth()-p),e.push({label:/* translators: %s = a number. */ /* translators: %s = a number. */(0,a.sprintf)((0,a._n)("%s period before","%s periods before",i,"patrons-tips"),i)+" ("+u(t.getFullYear(),t.getMonth(),0)+")",value:"first day of this month -"+i*p+" month"});return e})(),onChange:t=>e.onChange(t)})}function p(e){const{attachmentCategories:t}=(0,n.useSelect)((e=>{const{getEntityRecords:t}=e("core");return{attachmentCategories:t("taxonomy","patips_attachment_cat")}})),p=()=>{let e=[];return[t].forEach((t=>{var a;(t=null!==(a=t)&&void 0!==a?a:[]).length&&(e=e.concat(t))})),e},d=()=>{let t=p(),a=[];return e.attributes.categories.forEach((e=>{let i="(#"+e+")",r=t.find((t=>e===parseInt(t.id)));void 0!==r&&(i=r.name+" "+i),a.push(i)})),a},[c,u]=(0,r.useState)((()=>d()));return(0,r.useEffect)((()=>{e.setAttributes({categories:c.map((e=>parseInt(e.substring(e.lastIndexOf("#")+1,e.lastIndexOf(")")))))})}),[c]),(0,r.useEffect)((()=>{let e=d();u(e)}),[t]),(0,s.jsxs)(i.InspectorControls,{children:[(0,s.jsx)(o.PanelBody,{title:(0,a.__)("Period","patrons-tips"),children:(0,s.jsx)(l,{label:(0,a.__)("Period","patrons-tips"),value:e.attributes.period,onChange:t=>e.setAttributes({period:t})})}),(0,s.jsx)(o.PanelBody,{title:(0,a.__)("Filters","patrons-tips"),children:(0,s.jsx)(o.FormTokenField,{label:(0,a.__)("Categories","patrons-tips"),value:c,suggestions:(()=>{let e=p();return e.length?e.map((e=>e.name+" (#"+e.id+")")):[]})(),onChange:e=>{u(e)},__experimentalShowHowTo:!0,__experimentalExpandOnFocus:!0})}),(0,s.jsxs)(o.PanelBody,{title:(0,a.__)("Image settings","patrons-tips"),children:[(0,s.jsx)(o.SelectControl,{label:(0,a.__)("Image size","patrons-tips"),value:e.attributes.imageSize,options:[{label:(0,a.__)("Full Size","patrons-tips"),value:"full"},{label:(0,a.__)("Large","patrons-tips"),value:"large"},{label:(0,a.__)("Medium","patrons-tips"),value:"medium"},{label:(0,a.__)("Thumbnail","patrons-tips"),value:"thumbnail"}],onChange:t=>e.setAttributes({imageSize:t})}),(0,s.jsx)(o.TextControl,{type:"number",label:(0,a.__)("Per page","patrons-tips"),value:e.attributes.perPage,onChange:t=>e.setAttributes({perPage:parseInt(t)})})]})]})}const d={from:[{type:"block",blocks:["core/legacy-widget"],isMatch:({idBase:e,instance:t})=>t?.raw&&"patips_widget_period_media"===e,transform({instance:t}){var a;return(0,e.createBlock)("patrons-tips/period-media",{imageSize:null!==(a=t?.raw?.image_size)&&void 0!==a?a:""})}},{type:"shortcode",tag:["patronstips_period_media"],isMatch:e=>!0,transform(t,a){var i,r;return(0,e.createBlock)("patrons-tips/period-media",{period:null!==(i=t?.named?.date)&&void 0!==i?i:"",categories:void 0!==t?.named?.categories?t.named.categories.split(",").map((e=>parseInt(e))):[],imageSize:null!==(r=t?.named?.image_size)&&void 0!==r?r:"",perPage:void 0!==t?.named?.per_page?parseInt(t.named.per_page):1})}}]};(0,e.registerBlockType)(t,{edit:function(e){const t=(0,i.useBlockProps)(),[n,l]=(0,r.useState)(!1),[d,c]=(0,r.useState)(""),u=(g=300,m=()=>{l(!0),fetch(patips_var.ajaxurl,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams({action:"patipsGetPeriodMedia",period:e.attributes.period,categories:JSON.stringify(e.attributes.categories),image_size:e.attributes.imageSize,per_page:e.attributes.perPage,nonce:patips_var.nonce_get_period_media})}).then((e=>e.json())).then((e=>{"success"===e?.status&&void 0!==e.html&&c(e.html?e.html:(0,a.__)("No results.","patrons-tips")),l(!1)})).catch((e=>{console.log("AJAX error",e),l(!1)}))},v=(h||{}).atBegin,function(e,t,a){var i,r=a||{},o=r.noTrailing,n=void 0!==o&&o,s=r.noLeading,l=void 0!==s&&s,p=r.debounceMode,d=void 0===p?void 0:p,c=!1,u=0;function g(){i&&clearTimeout(i)}function m(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];var s=this,p=Date.now()-u;function m(){u=Date.now(),t.apply(s,r)}function h(){i=void 0}c||(l||!d||i||m(),g(),void 0===d&&p>e?l?(u=Date.now(),n||(i=setTimeout(d?h:m,e))):m():!0!==n&&(i=setTimeout(d?h:m,void 0===d?e-p:e)))}return m.cancel=function(e){var t=(e||{}).upcomingOnly,a=void 0!==t&&t;g(),c=!a},m}(g,m,{debounceMode:!1!==(void 0!==v&&v)}));var g,m,h,v;return(0,r.useEffect)((()=>{u()}),[e.attributes.period,e.attributes.categories,e.attributes.imageSize,e.attributes.perPage]),(0,s.jsxs)(r.Fragment,{children:[(0,s.jsx)(p,{attributes:{period:e.attributes.period,categories:e.attributes.categories,imageSize:e.attributes.imageSize,perPage:e.attributes.perPage},setAttributes:e.setAttributes}),(0,s.jsx)("div",{...t,children:(0,s.jsx)("div",{className:"patips-period-media",children:n?(0,s.jsx)(o.Spinner,{}):(0,s.jsx)(r.RawHTML,{children:d})})})]})},save:function(e){return null},transforms:d})}},a={};function i(e){var r=a[e];if(void 0!==r)return r.exports;var o=a[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,a,r,o)=>{if(!a){var n=1/0;for(d=0;d<e.length;d++){for(var[a,r,o]=e[d],s=!0,l=0;l<a.length;l++)(!1&o||n>=o)&&Object.keys(i.O).every((e=>i.O[e](a[l])))?a.splice(l--,1):(s=!1,o<n&&(n=o));if(s){e.splice(d--,1);var p=r();void 0!==p&&(t=p)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[a,r,o]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={832:0,872:0};i.O.j=t=>0===e[t];var t=(t,a)=>{var r,o,[n,s,l]=a,p=0;if(n.some((t=>0!==e[t]))){for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(l)var d=l(i)}for(t&&t(a);p<n.length;p++)o=n[p],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},a=globalThis.webpackChunkpatips_blocks=globalThis.webpackChunkpatips_blocks||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var r=i.O(void 0,[872],(()=>i(886)));r=i.O(r)})();