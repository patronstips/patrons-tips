(()=>{"use strict";var t,e={664:()=>{const t=window.wp.blocks,e=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"patrons-tips/patron-list","version":"1.0.2","category":"patrons-tips","icon":"groups","title":"Patron list","description":"Display the patron list for the post or the period.","keywords":["patronage","patrons","list","credits","special thanks","post","period","month"],"example":{},"supports":{"html":false},"attributes":{"period":{"type":"string","default":""},"date":{"type":"string","default":""},"current":{"type":"boolean","default":true},"tiers":{"type":"array","default":[]},"showThanks":{"type":"boolean","default":false}},"textdomain":"patrons-tips","editorScript":"file:index.js","editorStyle":"file:index.css","style":"file:style-index.css","script":["patips-js-global-variables","patips-js-global-functions"]}'),r=window.wp.i18n,s=window.wp.blockEditor,o=window.wp.element,a=window.wp.components,i=window.wp.data;const n=window.ReactJSXRuntime;function p(t){var e;const o=null!==(e=patips_var?.tiers)&&void 0!==e?e:{};return(0,n.jsxs)(s.InspectorControls,{children:[(0,n.jsxs)(a.PanelBody,{title:(0,r.__)("Filters","patrons-tips"),children:[patips_var?.is_pro&&(0,n.jsx)(a.SelectControl,{label:(0,r.__)("Period","patrons-tips"),value:(()=>{let e=t.attributes.period;return"post"===t.attributes.period?e="postPeriod":"current"===t.attributes.period?e="currentPeriod":"post"===t.attributes.date?e="postDate":t.attributes.current&&(e="currentPatrons"),e})(),options:(()=>{let t=[{label:(0,r.__)("Current patrons","patrons-tips"),value:"currentPatrons"}];return patips_var?.is_pro&&(t.push({label:(0,r.__)("Patrons as of post publication date","patrons-tips"),value:"postDate"}),t.push({label:(0,r.__)("Current period patrons","patrons-tips"),value:"currentPeriod"}),t.push({label:(0,r.__)("Post period patrons","patrons-tips"),value:"postPeriod"})),t})(),onChange:e=>(e=>{var r;t.setAttributes({period:null!==(r={postPeriod:"post",currentPeriod:"current",postDate:"",currentPatrons:""}?.[e])&&void 0!==r?r:e,date:"postDate"===e?"post":"",current:"currentPatrons"===e})})(e)}),(0,n.jsx)(a.SelectControl,{multiple:!0,label:(0,r.__)("Tiers","patrons-tips"),value:t.attributes.tiers,options:(()=>{let t=[];return o&&Object.keys(o).map((e=>{var s;let a=o[e];t.push({value:a.id,
/* translators: %s is the tier ID */
label:null!==(s=a?.title)&&void 0!==s?s:(0,r.sprintf)((0,r.__)("Tier #%s","patrons-tips"),a.id)})})),t})(),onChange:e=>t.setAttributes({tiers:e.map((t=>parseInt(t)))})})]}),(0,n.jsx)(a.PanelBody,{title:(0,r.__)("Display","patrons-tips"),children:(0,n.jsx)(a.ToggleControl,{label:(0,r.__)("Show thanks","patrons-tips"),checked:t.attributes.showThanks,onChange:()=>t.setAttributes({showThanks:!t.attributes.showThanks})})})]})}const l={from:[{type:"shortcode",tag:["patronstips_patron_list"],isMatch:t=>!0,transform(e,r){var s,o;return(0,t.createBlock)("patrons-tips/patron-list",{period:null!==(s=e?.named?.period)&&void 0!==s?s:"",date:null!==(o=e?.named?.date)&&void 0!==o?o:"",current:void 0!==e?.named?.current&&parseInt(e.named.current),tiers:void 0!==e?.named?.tier_ids?e.named.tier_ids.split(",").map((t=>parseInt(t))):[],showThanks:!1})}},{type:"shortcode",tag:["patronstips_patron_list_thanks"],isMatch:t=>!0,transform(e,r){var s,o;return(0,t.createBlock)("patrons-tips/patron-list",{period:null!==(s=e?.named?.period)&&void 0!==s?s:"",date:null!==(o=e?.named?.date)&&void 0!==o?o:"",current:void 0!==e?.named?.current&&parseInt(e.named.current),tiers:void 0!==e?.named?.tier_ids?e.named.tier_ids.split(",").map((t=>parseInt(t))):[],showThanks:!0})}}]};(0,t.registerBlockType)(e,{edit:function(t){const e=(0,s.useBlockProps)(),l=(0,i.useSelect)((t=>t("core/editor").getCurrentPostId())),[d,u]=(0,o.useState)(!1),[c,h]=(0,o.useState)(""),b=(v=300,m=()=>{u(!0),fetch(patips_var.ajaxurl,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams({action:"patipsGetPatronList",post_id:l,period:t.attributes.period,date:t.attributes.date,current:t.attributes.current?1:0,tier_ids:JSON.stringify(t.attributes.tiers),show_thanks:t.attributes.showThanks?1:0,nonce:patips_var.nonce_get_patron_list})}).then((t=>t.json())).then((t=>{"success"===t?.status&&void 0!==t.html&&h(t.html?t.html:(0,r.__)("No results.","patrons-tips")),u(!1)})).catch((t=>{console.log("AJAX error",t),u(!1)}))},_=(w||{}).atBegin,function(t,e,r){var s,o=r||{},a=o.noTrailing,i=void 0!==a&&a,n=o.noLeading,p=void 0!==n&&n,l=o.debounceMode,d=void 0===l?void 0:l,u=!1,c=0;function h(){s&&clearTimeout(s)}function b(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];var n=this,l=Date.now()-c;function b(){c=Date.now(),e.apply(n,o)}function v(){s=void 0}u||(p||!d||s||b(),h(),void 0===d&&l>t?p?(c=Date.now(),i||(s=setTimeout(d?v:b,t))):b():!0!==i&&(s=setTimeout(d?v:b,void 0===d?t-l:t)))}return b.cancel=function(t){var e=(t||{}).upcomingOnly,r=void 0!==e&&e;h(),u=!r},b}(v,m,{debounceMode:!1!==(void 0!==_&&_)}));var v,m,w,_;return(0,o.useEffect)((()=>{b()}),[t.attributes.period,t.attributes.date,t.attributes.current,t.attributes.tiers,t.attributes.showThanks]),(0,n.jsxs)(o.Fragment,{children:[(0,n.jsx)(p,{attributes:{period:t.attributes.period,date:t.attributes.date,current:t.attributes.current,tiers:t.attributes.tiers,showThanks:t.attributes.showThanks},setAttributes:t.setAttributes}),(0,n.jsx)("div",{...e,children:(0,n.jsx)("div",{className:"patips-patron-list-block"+(t.isSelected?" patips-selected-block":""),children:d?(0,n.jsx)(a.Spinner,{}):(0,n.jsx)(o.RawHTML,{children:c})})})]})},save:function(t){return null},transforms:l})}},r={};function s(t){var o=r[t];if(void 0!==o)return o.exports;var a=r[t]={exports:{}};return e[t](a,a.exports,s),a.exports}s.m=e,t=[],s.O=(e,r,o,a)=>{if(!r){var i=1/0;for(d=0;d<t.length;d++){for(var[r,o,a]=t[d],n=!0,p=0;p<r.length;p++)(!1&a||i>=a)&&Object.keys(s.O).every((t=>s.O[t](r[p])))?r.splice(p--,1):(n=!1,a<i&&(i=a));if(n){t.splice(d--,1);var l=o();void 0!==l&&(e=l)}}return e}a=a||0;for(var d=t.length;d>0&&t[d-1][2]>a;d--)t[d]=t[d-1];t[d]=[r,o,a]},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={883:0,483:0};s.O.j=e=>0===t[e];var e=(e,r)=>{var o,a,[i,n,p]=r,l=0;if(i.some((e=>0!==t[e]))){for(o in n)s.o(n,o)&&(s.m[o]=n[o]);if(p)var d=p(s)}for(e&&e(r);l<i.length;l++)a=i[l],s.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return s.O(d)},r=globalThis.webpackChunkpatips_blocks=globalThis.webpackChunkpatips_blocks||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var o=s.O(void 0,[483],(()=>s(664)));o=s.O(o)})();