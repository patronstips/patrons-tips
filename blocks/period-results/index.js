(()=>{"use strict";var e,t={50:()=>{const e=window.wp.blocks,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"patrons-tips/period-results","version":"1.0.4","category":"patrons-tips","icon":"money-alt","title":"Number of patrons / Income","description":"Display number of patrons and income for the period.","keywords":["patronage","patrons","number","amount","figure","quantity","income","earnings","revenus","gains","profit","gain","money","period","month"],"example":{},"supports":{"html":false},"attributes":{"period":{"type":"string","default":"current"},"display":{"type":"string","default":""},"zeroText":{"type":"string","default":""},"raw":{"type":"boolean","default":false},"decimals":{"type":"integer","default":0},"includeTax":{"type":"boolean","default":true},"includeDiscounts":{"type":"boolean","default":false},"includeScheduled":{"type":"boolean","default":true},"includeManual":{"type":"boolean","default":false}},"textdomain":"patrons-tips","editorScript":"file:index.js","editorStyle":"file:index.css","style":"file:style-index.css","script":["patips-js-global-variables","patips-js-global-functions"]}'),a=window.wp.i18n,i=window.wp.blockEditor,n=window.wp.element,r=window.wp.components;const s=window.ReactJSXRuntime;function o(e){var t;const i=null!==(t=e?.periodPatronNb)&&void 0!==t?t:0;return(0,s.jsx)("div",{className:"patips-patron-nb-container"+(i||""===e.attributes.zeroText?"":" patips-zero-text"),children:i||""===e.attributes.zeroText?e.attributes.raw?i:(0,s.jsx)(n.RawHTML,{children:(0,a.sprintf)((0,a._n)("%s patron","%s patrons",i,"patrons-tips"),'<strong class="patips-patron-nb">'+i+"</strong>")}):e.attributes.zeroText})}function l(e){var t,a;const i=null!==(t=e?.periodIncome)&&void 0!==t?t:0;return(0,s.jsx)("div",{className:"patips-period-income-container"+(i||""===e.attributes.zeroText?"":" patips-zero-text"),children:i||""===e.attributes.zeroText?e.attributes.raw?i:(0,s.jsx)("strong",{className:"patips-period-income",children:patips_format_price(i,{plain_text:!0,decimals:null!==(a=e?.attributes?.decimals)&&void 0!==a?a:0})}):e.attributes.zeroText})}function d(e){var t,i,n,o,l;const d=null!==(t=e?.periodDuration)&&void 0!==t?t:void 0!==patips_var?.period_duration?parseInt(patips_var.period_duration):1,u=null!==(i=e?.periodNb)&&void 0!==i?i:12,c=null!==(n=e?.options)&&void 0!==n?n:[],p=(e,t,a)=>{let i=new Date(e,t,a||1),n=void 0!==patips_var?.locale?patips_var.locale.replace("_","-"):"en-US";return i.toLocaleString(n,a?{day:"numeric",month:"long",year:"numeric"}:{month:"long",year:"numeric"})};return(0,s.jsx)(r.SelectControl,{label:null!==(o=e?.label)&&void 0!==o?o:"",value:null!==(l=e?.value)&&void 0!==l?l:"",options:(()=>{let e=c.concat([{label:(0,a.__)("Current period","patrons-tips"),value:"current"}]),t=new Date;t.setDate(1);for(let i=1;i<=u;i++)t.setMonth(t.getMonth()-d),e.push({label:/* translators: %s = a number. */ /* translators: %s = a number. */(0,a.sprintf)((0,a._n)("%s period before","%s periods before",i,"patrons-tips"),i)+" ("+p(t.getFullYear(),t.getMonth(),0)+")",value:"first day of this month -"+i*d+" month"});return e})(),onChange:t=>e.onChange(t)})}function u(e){var t;return(0,s.jsxs)(i.InspectorControls,{children:[(0,s.jsx)(r.PanelBody,{title:(0,a.__)("Period","patrons-tips"),children:(0,s.jsx)(d,{label:(0,a.__)("Period","patrons-tips"),value:e.attributes.period,onChange:t=>e.setAttributes({period:t})})}),(0,s.jsxs)(r.PanelBody,{title:(0,a.__)("Display","patrons-tips"),children:[(0,s.jsx)(r.SelectControl,{label:(0,a.__)("Data to display","patrons-tips"),value:e.attributes.display,options:[{label:(0,a.__)("Number of patrons and income","patrons-tips"),value:"both"},{label:(0,a.__)("Number of patrons","patrons-tips"),value:"patron_nb"},{label:(0,a.__)("Income","patrons-tips"),value:"income"}],onChange:t=>e.setAttributes({display:t})}),(0,s.jsx)(r.TextControl,{type:"text",label:(0,a.__)("Text when value is zero","patrons-tips"),value:e.attributes.zeroText,onChange:t=>e.setAttributes({zeroText:t})}),(0,s.jsx)(r.ToggleControl,{label:(0,a.__)("Show value without formatting","patrons-tips"),checked:e.attributes.raw,onChange:()=>e.setAttributes({raw:!e.attributes.raw})})]}),("income"===e.attributes.display||"both"===e.attributes.display)&&(0,s.jsxs)(r.PanelBody,{title:(0,a.__)("Calculation","patrons-tips"),children:[(0,s.jsx)(r.RangeControl,{label:(0,a.__)("Number of decimals","patrons-tips"),value:e.attributes.decimals,onChange:t=>e.setAttributes({decimals:parseInt(t)}),min:0,max:3,step:1,withInputField:!0,isShiftStepEnabled:!0}),(0,s.jsx)(r.ToggleControl,{label:(0,a.__)("Include tax","patrons-tips"),checked:e.attributes.includeTax,onChange:()=>e.setAttributes({includeTax:!e.attributes.includeTax})}),(0,s.jsx)(r.ToggleControl,{label:(0,a.__)("Include discounts","patrons-tips"),checked:e.attributes.includeDiscounts,onChange:()=>e.setAttributes({includeDiscounts:!e.attributes.includeDiscounts})}),""!==(null!==(t=patips_var?.subscription_plugin)&&void 0!==t?t:"")&&(0,s.jsx)(r.ToggleControl,{label:(0,a.__)("Include scheduled payments","patrons-tips"),checked:e.attributes.includeScheduled,onChange:()=>e.setAttributes({includeScheduled:!e.attributes.includeScheduled})}),(0,s.jsx)(r.ToggleControl,{label:(0,a.__)("Include patronage without payments","patrons-tips"),checked:e.attributes.includeManual,onChange:()=>e.setAttributes({includeManual:!e.attributes.includeManual})})]})]})}const c={from:[{type:"block",blocks:["core/legacy-widget"],isMatch:({idBase:e,instance:t})=>t?.raw&&"patips_widget_patron_number"===e,transform({instance:t}){var a;return(0,e.createBlock)("patrons-tips/period-results",{display:"patron_nb",zeroText:null!==(a=t?.raw?.zero_text)&&void 0!==a?a:"",raw:void 0!==t?.raw?.raw&&parseInt(t?.raw?.raw)})}},{type:"block",blocks:["core/legacy-widget"],isMatch:({idBase:e,instance:t})=>t?.raw&&"patips_widget_period_income"===e,transform({instance:t}){var a,i;return(0,e.createBlock)("patrons-tips/period-results",{display:"income",zeroText:null!==(a=t?.raw?.zero_text)&&void 0!==a?a:"",raw:void 0!==t?.raw?.raw&&parseInt(t?.raw?.raw),decimals:void 0!==t?.raw?.decimals?parseInt(t?.raw?.decimals):0,includeTax:void 0!==t?.raw?.include_tax?parseInt(t?.raw?.include_tax):null===(i=patips_var?.include_tax)||void 0===i||i,includeDiscounts:void 0!==t?.raw?.include_discounts&&parseInt(t?.raw?.include_discounts),includeScheduled:void 0===t?.raw?.include_scheduled||parseInt(t?.raw?.include_scheduled),includeManual:void 0!==t?.raw?.include_manual&&parseInt(t?.raw?.include_manual)})}},{type:"shortcode",tag:["patronstips_patron_number"],isMatch:e=>!0,transform(t,a){var i,n;return(0,e.createBlock)("patrons-tips/period-results",{display:"patron_nb",period:null!==(i=t?.named?.period)&&void 0!==i?i:"",zeroText:null!==(n=t?.named?.zero_text)&&void 0!==n?n:"",raw:void 0!==t?.named?.raw&&parseInt(t?.named?.raw)})}},{type:"shortcode",tag:["patronstips_period_income"],isMatch:e=>!0,transform(t,a){var i,n,r;return(0,e.createBlock)("patrons-tips/period-results",{display:"income",period:null!==(i=t?.named?.period)&&void 0!==i?i:"",zeroText:null!==(n=t?.named?.zero_text)&&void 0!==n?n:"",raw:void 0!==t?.named?.raw&&parseInt(t?.named?.raw),decimals:void 0!==t?.named?.decimals?parseInt(t?.named?.decimals):0,includeTax:void 0!==t?.named?.include_tax?parseInt(t?.named?.include_tax):null===(r=patips_var?.include_tax)||void 0===r||r,includeDiscounts:void 0!==t?.named?.include_discounts&&parseInt(t?.named?.include_discounts),includeScheduled:void 0===t?.named?.include_scheduled||parseInt(t?.named?.include_scheduled),includeManual:void 0!==t?.named?.include_manual&&parseInt(t?.named?.include_manual)})}}]};(0,e.registerBlockType)(t,{attributes:Object.assign({},t.attributes,{display:{type:"string",default:patips_var?.is_woocommerce?"both":"patron_nb"}}),edit:function(e){const t=(0,i.useBlockProps)(),a=()=>"both"===e.attributes.display&&!p&&!m&&""!==e.attributes.zeroText,[d,c]=(0,n.useState)(!1),[p,b]=(0,n.useState)(0),[m,v]=(0,n.useState)(0),[h,_]=(0,n.useState)((()=>a())),x=(w=300,f=()=>{c(!0),fetch(patips_var.ajaxurl,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams({action:"patipsGetPeriodResults",period:e.attributes.period,include_tax:e.attributes.includeTax?1:0,include_discounts:e.attributes.includeDiscounts?1:0,include_scheduled:e.attributes.includeScheduled?1:0,include_manual:e.attributes.includeManual?1:0,nonce:patips_var.nonce_get_period_results})}).then((e=>e.json())).then((e=>{"success"===e?.status&&(void 0!==e.patron_nb&&b(e.patron_nb),void 0!==e.income&&v(e.income)),c(!1)})).catch((e=>{console.log("AJAX error",e),c(!1)}))},y=(g||{}).atBegin,function(e,t,a){var i,n=a||{},r=n.noTrailing,s=void 0!==r&&r,o=n.noLeading,l=void 0!==o&&o,d=n.debounceMode,u=void 0===d?void 0:d,c=!1,p=0;function b(){i&&clearTimeout(i)}function m(){for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];var o=this,d=Date.now()-p;function m(){p=Date.now(),t.apply(o,n)}function v(){i=void 0}c||(l||!u||i||m(),b(),void 0===u&&d>e?l?(p=Date.now(),s||(i=setTimeout(u?v:m,e))):m():!0!==s&&(i=setTimeout(u?v:m,void 0===u?e-d:e)))}return m.cancel=function(e){var t=(e||{}).upcomingOnly,a=void 0!==t&&t;b(),c=!a},m}(w,f,{debounceMode:!1!==(void 0!==y&&y)}));var w,f,g,y;return(0,n.useEffect)((()=>{_(a())}),[e.attributes.display,p,m,e.attributes.zeroText]),(0,n.useEffect)((()=>{x()}),[e.attributes.period]),(0,n.useEffect)((()=>{"income"!==e.attributes.display&&"both"!==e.attributes.display||x()}),[e.attributes.includeTax,e.attributes.includeDiscounts,e.attributes.includeScheduled,e.attributes.includeManual]),(0,s.jsxs)(n.Fragment,{children:[(0,s.jsx)(u,{attributes:{period:e.attributes.period,display:e.attributes.display,zeroText:e.attributes.zeroText,raw:e.attributes.raw,decimals:e.attributes.decimals,includeTax:e.attributes.includeTax,includeDiscounts:e.attributes.includeDiscounts,includeScheduled:e.attributes.includeScheduled,includeManual:e.attributes.includeManual},setAttributes:e.setAttributes}),(0,s.jsx)("div",{...t,children:(0,s.jsxs)("div",{className:"patips-period-results"+(e.isSelected?" patips-selected-block":""),children:[d&&(0,s.jsx)(r.Spinner,{}),h&&!d&&(0,s.jsx)("div",{className:"patips-zero-text",children:e.attributes.zeroText}),("patron_nb"===e.attributes.display||"both"===e.attributes.display)&&!h&&!d&&(0,s.jsx)(o,{periodPatronNb:p,attributes:{zeroText:"patron_nb"===e.attributes.display?e.attributes.zeroText:"",raw:e.attributes.raw},isSelected:e.isSelected}),("income"===e.attributes.display||"both"===e.attributes.display)&&!h&&!d&&(0,s.jsx)(l,{periodIncome:m,attributes:{zeroText:"income"===e.attributes.display?e.attributes.zeroText:"",raw:e.attributes.raw,decimals:e.attributes.decimals},isSelected:e.isSelected})]})})]})},save:function(e){return null},transforms:c})}},a={};function i(e){var n=a[e];if(void 0!==n)return n.exports;var r=a[e]={exports:{}};return t[e](r,r.exports,i),r.exports}i.m=t,e=[],i.O=(t,a,n,r)=>{if(!a){var s=1/0;for(u=0;u<e.length;u++){for(var[a,n,r]=e[u],o=!0,l=0;l<a.length;l++)(!1&r||s>=r)&&Object.keys(i.O).every((e=>i.O[e](a[l])))?a.splice(l--,1):(o=!1,r<s&&(s=r));if(o){e.splice(u--,1);var d=n();void 0!==d&&(t=d)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[a,n,r]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={654:0,786:0};i.O.j=t=>0===e[t];var t=(t,a)=>{var n,r,[s,o,l]=a,d=0;if(s.some((t=>0!==e[t]))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)var u=l(i)}for(t&&t(a);d<s.length;d++)r=s[d],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(u)},a=globalThis.webpackChunkpatips_blocks=globalThis.webpackChunkpatips_blocks||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var n=i.O(void 0,[786],(()=>i(50)));n=i.O(n)})();