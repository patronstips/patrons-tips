$j(document).ready(function(){patips_init_tooltip();patips_init_jquery_ui_dialogs();patips_init_select2();"undefined"===typeof postboxes||"undefined"===typeof pagenow||"patrons-tips_page_patips_tiers"!==pagenow&&"patrons-tips_page_patips_patrons"!==pagenow||postboxes.add_postbox_toggles(pagenow);$j("body").on("select2:select",'.patips-select2-ajax[data-sortable="1"], .patips-select2-no-ajax[data-sortable="1"]',function(a){"undefined"!==typeof a.params&&"undefined"!==typeof a.params.data&&"undefined"!==
typeof a.params.data.id&&(a=a.params.data.id,a=$j(this).find('option[value="'+a+'"]'),a.length&&(a.detach(),$j(this).append(a),$j(this).trigger("change")))});$j("body").on("click",".ui-widget-overlay",function(){$j(".patips-dialog:ui-dialog:visible").dialog("close")});$j(".patips-upload-image-button").on("click",function(a){a.preventDefault();(a=$j(this).data("desired-data"))||(a="url");var b=$j(this).data("field-id");b=$j("#"+b);b.length&&patips_open_wp_media_modal(void 0,b,a)});$j(".patips-media-input-remove").on("click",
function(){$j(this).siblings("img.patips-media-input-preview-img").remove();$j(this).parents(".patips-media-input-preview").removeClass("patips-has-img");$j(this).parents(".patips-media-inputs").find(".patips-input").val("")});$j(".patips-settings-table, .patips-list-table").on("click","tbody tr",function(){$j(".patips-selected-row").removeClass("patips-selected-row");$j(this).addClass("patips-selected-row")});$j(".patips-dialog").dialog({open:function(){$j.ui&&$j.ui.dialog&&!$j.ui.dialog.prototype._allowInteractionRemapped&&
$j(this).closest(".ui-dialog").length&&($j.ui.dialog.prototype._allowInteraction?($j.ui.dialog.prototype._allowInteraction=function(a){return $j(a.target).closest(".select2-drop").length||"undefined"===typeof ui_dialog_interaction?!0:ui_dialog_interaction.apply(this,arguments)},$j.ui.dialog.prototype._allowInteractionRemapped=!0):$j.error("You must upgrade jQuery UI or else."))},_allowInteraction:function(a){return!(!$j(a.target).is(".select2-input")||this._super(a))}});$j(".patips-admin-notice").on("click",
".notice-dismiss",function(){var a=$j(this).closest(".patips-admin-notice").data("notice-id");a&&patips_dismiss_admin_notice(a)})});function patips_pad(a,b){a=a.toString();return a.length<b?patips_pad("0"+a,b):a}function patips_init_tooltip(){"function"==typeof $j.fn.tipTip&&$j(".patips-tooltip").tipTip({attribute:"data-message",fadeIn:200,fadeOut:200,delay:200,maxWidth:"300px",keepAlive:!0})}
function patips_init_select2(){if($j.fn.select2){var a={language:patips_var.fullcalendar_locale,containerCssClass:"patips-select2-selection",selectionCssClass:"patips-select2-selection",dropdownCssClass:"patips-select2-dropdown",minimumResultsForSearch:1,minimumInputLength:0,width:"element",dropdownAutoWidth:!0,dropdownParent:$j(this).closest(".patips-dialog").length?$j(this).closest(".patips-dialog"):$j("body"),escapeMarkup:function(b){return b}};$j("body").trigger("patips_select2_init_data",[a]);
$j(".patips-select2-no-ajax:not(.select2-hidden-accessible)").select2(a);$j(".patips-select2-ajax:not(.select2-hidden-accessible)").select2($j.extend(!0,a,{minimumResultsForSearch:0,ajax:{url:patips_var.ajaxurl,dataType:"json",delay:1E3,data:function(b){var e=$j(this).data("type")?$j(this).data("type").trim():"",c=$j(this).data("params")?JSON.parse(JSON.stringify($j(this).data("params"))):{},d=[];$j(this).find("option").each(function(){""!==$j(this).val()&&d.push({id:$j(this).val(),text:$j(this).text()})});
b=$j.extend(c,{action:e?"patipsSelect2Query_"+e:"patipsSelect2Query",term:"string"==typeof b.term?b.term:"",options:d,name:$j(this).attr("name")?$j(this).attr("name"):"",id:$j(this).attr("id")?$j(this).attr("id"):"",nonce:patips_var.nonce_query_select2_options});$j(this).trigger("patips_select2_query_data",[b]);return b},processResults:function(b){var e={results:"undefined"!==typeof b.options?b.options:[]};$j(this).trigger("patips_select2_query_results",[e,b]);return e},transport:function(b,e,c){if(b.data.term.length>=
Math.max(a.minimumInputLength,3)){var d=$j.ajax(b);d.then(e);d.fail(c)}else d={abort:function(){}},e({options:b.data.options});return d},cache:!0}}));$j("body").on("select2:open",".patips-select2-ajax",function(){$j("input.select2-search__field").attr("placeholder",patips_var.select2_search_placeholder.replace("{nb}",Math.max(a.minimumInputLength,3)))});patips_select2_sortable_init()}}
function patips_select2_sortable_init(a){"undefined"===typeof a&&(a='.select2-hidden-accessible[data-sortable="1"] + .select2-container .patips-select2-selection.select2-selection--multiple .select2-selection__rendered');$j(a).length&&$j(a).sortable({containment:"parent",items:".select2-selection__choice",update:function(b,e){var c=$j(e.item).parents(".select2-container").prev(".select2-hidden-accessible");c.length&&c.data("sortable")&&$j(e.item).parents(".select2-container").find(".select2-selection__choice").each(function(d,
f){d=!1;"undefined"!==typeof $j(f).data("data")&&"undefined"!==typeof $j(f).data("data").id&&(d=$j(f).data("data").id);if(!1===d)return!0;f=c.find('option[value="'+d+'"]');if(!f.length)return!0;f.detach();c.append(f)})}})}function patips_init_jquery_ui_dialogs(a){"undefined"===typeof a&&(a=".patips-dialog");$j(a).dialog({modal:!0,autoOpen:!1,minHeight:300,minWidth:460,resize:"auto",show:!0,hide:!0,dialogClass:"patips-jquery-ui-dialog"})}
function patips_open_wp_media_modal(a,b,e){a||(a=wp.media({multiple:!1}),a.on("select",function(){var c=a.state().get("selection").first().toJSON();"undefined"!==typeof c[e]&&b.val(c[e]);b.siblings(".patips-media-input-preview").length&&(b.siblings(".patips-media-input-preview").find("img.patips-media-input-preview-img").remove(),b.siblings(".patips-media-input-preview").removeClass("patips-has-img"),c?.url&&(b.siblings(".patips-media-input-preview").append('<img src="'+c.url+'" class="patips-media-input-preview-img"/>'),
b.siblings(".patips-media-input-preview").addClass("patips-has-img")))}));a.open()}
function patips_serialize_object(a){function b(c,d){if(1>c.length)return d;var f=c[0];"]"==f.slice(-1)&&(f=f.slice(0,-1));var g={};1==c.length?g[f]=d:(c.shift(),c=b(c,d),g[f]=c);return g}var e={};a=function(c){var d=[];$j.each(c.serializeArray(),function(f,g){if(0>g.name.indexOf("[]"))return d.push(g),!0;var h=g.name.split("[]")[0],k=!1;$j.each(d,function(l,m){m.name===h&&(k=!0,d[l].value.push(g.value))});k||d.push({name:h,value:[g.value]})});return d}(a);$j.each(a,function(){var c=this.value,d=this.name.split("[");
c=b(d,c);$j.extend(!0,e,c)});return e}
function patips_toggle_multiple_select(a,b){b="undefined"!==typeof b?b?!0:!1:!a.prop("multiple");if(b===!a.prop("multiple")){a.trigger("patips_toggle_multiple_select_before",[b]);a.prop("multiple",b);a.find('option[value="all"]').prop("disabled",b);a.find('option[value="none"]').prop("disabled",b);a.find('option[data-not-multiple="1"]').prop("disabled",b);a.find("option:disabled:selected").prop("selected",!1);var e=a.attr("name");b?a.attr("name",e+"[]"):a.attr("name",e.replace("[]",""));if(!b){e=
a.val();var c=null;e&&(Array.isArray(e)||(e=[e]),$j.each(e,function(d,f){d=a.find('option[value="'+f+'"]');if(d.length&&!d.is(":disabled"))return c=d.attr("value"),!1}));a.val(c).trigger("change")}if(a.hasClass("select2-hidden-accessible")){if(!$j.fn.select2)return;a.select2("destroy");patips_init_select2()}a.trigger("patips_toggle_multiple_select_after",[b])}}
function patips_dismiss_admin_notice(a){""!=a&&$j.ajax({url:patips_var.ajaxurl,type:"POST",data:{action:"patipsDismissAdminNotice",notice_id:a,nonce:patips_var.nonce_dismiss_admin_notice},dataType:"json",success:function(b){"success"!==b.status&&console.log(a,b)},error:function(b){console.log(b)},complete:function(){}})};
