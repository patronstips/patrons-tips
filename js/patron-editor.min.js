$j(document).ready(function(){$j("#patips-patron-filter-container-periods").on("change","#patips-patron-filter-period-from-month, #patips-patron-filter-period-from-year, #patips-patron-filter-period-to-month, #patips-patron-filter-period-to-year, #patips-patron-filter-period-current",function(){var a=$j("#patips-patron-filter-period-from-month").val(),c=$j("#patips-patron-filter-period-from-year").val(),b=$j("#patips-patron-filter-period-to-month").val(),d=$j("#patips-patron-filter-period-to-year").val();
c||=(new Date).getFullYear();d||=(new Date).getFullYear();a=a?patips_pad(c,4)+"-"+patips_pad(a,2):"";b=b?patips_pad(d,4)+"-"+patips_pad(b,2):"";d=a||b?1:"";$j("#patips-patron-filter-period-from").val(a);$j("#patips-patron-filter-period-to").val(b);$j("#patips-patron-filter-period-duration").val(d);(a||b)&&$j("#patips-patron-filter-current").val("")});$j("#patips-patron-list-table-filters-form").on("change","#patips-patron-filter-current",function(){$j(this).val()&&($j("#patips-patron-filter-period-from-month").val(""),
$j("#patips-patron-filter-period-from-year").val(""),$j("#patips-patron-filter-period-to-month").val(""),$j("#patips-patron-filter-period-to-year").val(""),$j("#patips-patron-filter-period-from").val(""),$j("#patips-patron-filter-period-to").val(""),$j("#patips-patron-filter-period-duration").val(""))});$j("#patips-patron-user-id-selectbox").on("change",function(){patips_patron_editor_toggle_user_email_field()});patips_patron_editor_toggle_user_email_field();$j("#patips-patron-export-button").on("click",
function(){patips_dialog_patron_export()});$j('.patips-export-button input[type="button"]').on("click",function(){var a=$j(this).closest(".patips-export-url").find(".patips-export-url-field input").val();a&&window.open(a,"_blank")});$j("body").on("click","#patips-patron-settings-fields-history .patips-history-delete",function(){var a=$j(this).parents("tr").first(),c={is_allowed:!0};a.trigger("patips_delete_patron_history_entry",[c]);c.is_allowed&&("undefined"!==typeof a.data("entry")&&(c=$j("#patips-patron-settings-fields-history .patips-deleted-history-entry-input").length,
$j("#patips-patron-settings-fields-history").append('<input type="hidden" name="deleted_history_entry_ids['+c+']" value="'+a.data("entry")+'" class="patips-deleted-history-entry-input"/>')),a.animate({opacity:0},function(){a.remove();0>=$j("#patips-patron-settings-fields-history tbody tr").length&&$j("#patips-patron-settings-fields-history").append('<div id="patips-patron-history-empty-message">'+patips_var.no_history+"</div>")}))})});
function patips_patron_editor_toggle_user_email_field(){$j("#patips-patron-user-id-selectbox").val()?($j("#patips-patron-user-email").val(""),$j("#patips-patron-user-email-container").hide()):$j("#patips-patron-user-email-container").show()}
function patips_dialog_patron_export(){$j("#patips-patron-export-url-secret").val("");$j("#patips-patron-export-url-container").hide();$j("#patips-patron-export-dialog .patips-notices").remove();$j("#patips-patron-export-dialog").dialog("option","buttons",[{text:patips_var.button_generate_export_link,click:function(){patips_generate_patron_export_url(!1)}},{text:patips_var.button_reset,"class":"patips-dialog-delete-button patips-dialog-left-button",click:function(){patips_generate_patron_export_url(!0)}}]);
$j("#patips-patron-export-dialog").dialog("open")}
function patips_generate_patron_export_url(a){a=a||!1;$j("#patips-patron-export-dialog .patips-notices").remove();patips_add_loading_html($j("#patips-patron-export-dialog"));var c=patips_serialize_object($j("#patips-patron-export-form"));c.action="patipsPatronExportUrl";c.reset_key=a?1:0;c.patron_filters=patips_get_patron_list_table_filters();$j("body").trigger("patips_patron_export_url_data",[c,a]);$j.ajax({url:ajaxurl,type:"POST",data:c,dataType:"json",success:function(b){if("success"===b.status)$j("#patips-patron-export-url-secret").val(b.url),
$j("#patips-patron-export-dialog").append('<div class="patips-notices"><ul class="patips-success-list"><li>'+b.message+"</li></ul></div>"),$j("#patips-patron-export-url-container").show(),$j("body").trigger("patips_patron_export_url",[b]);else if("failed"===b.status){var d="undefined"!==typeof b.message?b.message:patips_var.error;$j("#patips-patron-export-dialog").append('<div class="patips-notices"><ul class="patips-error-list"><li>'+d+"</li></ul></div>");console.log(d);console.log(b)}},error:function(b){$j("#patips-patron-export-dialog").append('<div class="patips-notices"><ul class="patips-error-list"><li>AJAX '+
patips_var.error+"</li></ul></div>");console.log("AJAX "+patips_var.error);console.log(b)},complete:function(){$j("#patips-patron-export-dialog .patips-notices").show();patips_remove_loading_html($j("#patips-patron-export-dialog"))}})}
function patips_get_patron_list_table_filters(){var a=$j("#patips-patron-list-table-filters-form").length?patips_serialize_object($j("#patips-patron-list-table-filters-form")):{};$j("#patips-patron-list-table-filters-form").trigger("patips_patron_list_table_filters",[a]);return a};
